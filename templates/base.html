{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RAG Chat Assistant{% endblock %}</title>
        <link rel="stylesheet" href="{% static 'css/chatgpt.css' %}?v={{ "now"|date:"YmdHis" }}">
    {% if not user.is_authenticated %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% endif %}
</head>
<body>
    {% if user.is_authenticated %}
        {% if messages %}
            <div class="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; pointer-events: none;">
                {% for message in messages %}
                    <div class="message-toast" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px 16px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); pointer-events: auto;">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% else %}
        <style>
          :root { color-scheme: light dark; }
          @media (prefers-color-scheme: light) {
            body { background: #f7f7f8; color: #0f172a; }
          }
          @media (prefers-color-scheme: dark) {
            body { background: #0f0f10; color: #e5e7eb; }
          }
        </style>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="{% url 'landing' %}">RAG Chat Assistant</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <style>
                          .pill-btn { display:inline-block; padding:8px 14px; border-radius:20px; font-weight:600; text-decoration:none; margin-left:10px; }
                          .pill-login { background:#fff; color:#111; }
                          .pill-login:hover { filter:brightness(0.95); color:#111; }
                          .pill-signup { background:transparent; color:#e5e7eb; border:1px solid #3a3b3f; }
                          .pill-signup:hover { background:#27292d; color:#fff; border-color:#4b4f56; }
                        </style>
                        <li class="nav-item">
                            <a class="pill-btn pill-login" href="{% url 'accounts:login' %}">Log in</a>
                        </li>
                        <li class="nav-item">
                            <a class="pill-btn pill-signup" href="{% url 'accounts:register' %}">Sign up</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <main class="container mt-4">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        </main>
    {% endif %}
    
    {% block content %}{% endblock %}
    
    {% if not user.is_authenticated %}
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    {% endif %}
    <script src="{% static 'js/chat.js' %}"></script>
    <script>
    // Auto-dismiss authenticated toast messages
    (function() {
        const container = document.querySelector('.toast-container');
        if (container) {
            setTimeout(() => {
                container.style.transition = 'opacity 300ms ease';
                container.style.opacity = '0';
                setTimeout(() => container.remove(), 350);
            }, 2500); // hide after 2.5s
        }
    })();
    </script>
</body>
</html>